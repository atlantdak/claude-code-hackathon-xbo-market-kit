# 2026-02-25 — Widget Styling Redesign (Tailwind → BEM + CSS Custom Properties)

## Summary

Completely replaced Tailwind CDN dependency with a custom design system inspired by
xbo.com visual language. Built using CSS Custom Properties for theming, BEM naming
for isolation, and PostCSS for build pipeline. All 5 widgets refactored, dark mode
added, Gutenberg editor styles integrated. Zero Tailwind references remain.

## Time Tracking

| Phase | Duration |
|-------|----------|
| Research + Brainstorming (xbo.com scraping, approach evaluation) | ~12min |
| Design doc + Implementation plan | ~5min |
| Task 1: PostCSS build pipeline | ~2min |
| Task 2: Design tokens + base CSS | ~1.5min |
| Tasks 3-7: Widget CSS refactoring (5 widgets, parallel) | ~7min |
| Task 8: Tailwind removal + editor styles | ~2min |
| Task 9-10: Dark mode + integration verification | ~2min |
| Documentation (worklog + README) | ~2min |
| **Total active session time** | **~34min** |

## Completed

### Research & Design
- [x] Scraped xbo.com styles via Chrome DevTools MCP (colors, typography, spacing, shadows, animations)
- [x] Evaluated 4 approaches: Tailwind v4, CSS Custom Properties + BEM, Financial UI libs, Hybrid PostCSS
- [x] Identified Tailwind v4 CSS @layer conflict with WordPress Gutenberg (blocker)
- [x] Chose approach: CSS Custom Properties + BEM + PostCSS (xbo.com-inspired)
- [x] Design doc: [Widget Styling Design](../plans/2026-02-25-widget-styling-design.md)
- [x] Implementation plan: [Widget Styling Plan](../plans/2026-02-25-widget-styling-plan.md)

### Build Pipeline
- [x] Created `package.json` with PostCSS scripts (css:dev, css:build)
- [x] Configured PostCSS: postcss-import + postcss-nesting + cssnano
- [x] Modular CSS architecture: 8 source files → 1 minified bundle

### Design System (from xbo.com)
- [x] Design tokens in CSS custom properties (30+ variables)
- [x] Brand colors: purple #6319ff, positive #49b47a, negative #fd3b5e
- [x] Typography: IBM Plex Sans (Google Fonts) for financial data
- [x] Spacing, border radius, shadows — all from xbo.com CSS
- [x] Price flash animations matching xbo.com (2s fade green/red → neutral)
- [x] Dark mode via `prefers-color-scheme` and `.xbo-mk--dark` class

### Widget Refactoring (5 widgets)
- [x] Ticker: BEM CSS + HTML refactor + JS querySelector update
- [x] Movers: BEM CSS + HTML refactor (tabs, table, trend arrows)
- [x] Orderbook: BEM CSS + HTML refactor (depth bars, spread)
- [x] Trades: BEM CSS + HTML refactor (buy/sell badges)
- [x] Slippage: BEM CSS + HTML refactor (form, toggle, metrics grid)

### Integration
- [x] Removed Tailwind CDN script entirely
- [x] Updated asset enqueuing to load built CSS from `assets/css/dist/`
- [x] Added `enqueue_block_editor_assets` for Gutenberg live preview
- [x] Removed `enable_tailwind` setting from admin
- [x] Both dev and production CSS built and committed

### Verification
- [x] PHPUnit: 18 tests, 27 assertions — all pass
- [x] PHPCS: 0 errors (3 pre-existing warnings)
- [x] PHPStan level 6: 0 errors
- [x] Zero Tailwind references in codebase
- [x] CSS bundle: 15.7 KB minified (under 25 KB target)

## Commits

| Hash | Message |
|------|---------|
| `649d1c5` | docs: add widget styling design doc and implementation plan |
| `82d3c33` | feat(styles): add PostCSS build pipeline for widget CSS |
| `2749960` | feat(styles): add design tokens, base styles, and animations |
| `520447c` | feat(styles): refactor ticker widget to BEM CSS |
| `a7309f2` | feat(styles): refactor movers widget to BEM CSS |
| `6629ea8` | feat(styles): refactor orderbook widget to BEM CSS |
| `e6871d4` | feat(styles): refactor trades widget to BEM CSS |
| `d57444b` | feat(styles): refactor slippage widget to BEM CSS |
| `0855cd1` | feat(styles): replace Tailwind CDN with custom CSS, add editor styles |

## Metrics

| Metric | Value |
|--------|-------|
| Commits | 9 |
| Files changed | 24 |
| Lines added | ~3,527 |
| Lines removed | ~125 |
| CSS source files | 8 modules |
| CSS output (min) | 15.7 KB |
| CSS output (dev) | 19.7 KB |
| Unit tests | 18 pass |
| PHPCS errors | 0 |
| PHPStan errors | 0 |

## Decisions

- **CSS Custom Properties + BEM over Tailwind v4** — Tailwind v4's CSS @layer conflicts with WordPress admin styles in Gutenberg editor. This is an unresolved architectural incompatibility.
- **PostCSS over Webpack** — Minimal pipeline (3 plugins). No need for full bundler for CSS-only build.
- **IBM Plex Sans** — Same font family used on xbo.com for financial data display. Tabular numerals for aligned numbers.
- **xbo.com design tokens** — Extracted actual CSS values from xbo.com: colors, shadows, animations, spacing. Ensures visual consistency with the API source.
- **Committed dist/ CSS** — `assets/css/dist/` tracked in git for no-build deployment (hosts without Node.js).
- **SCRIPT_DEBUG support** — Loads unminified CSS when `SCRIPT_DEBUG` is true, minified otherwise.

## Architecture Change

```
BEFORE:
  Tailwind CDN Script (300KB JS) → JIT CSS in browser → Utility classes in PHP strings

AFTER:
  PostCSS Build → _variables.css + _base.css + 5 widget modules → widgets.min.css (15.7KB)
  CSS Custom Properties → Themeable via Gutenberg/Elementor controls
  BEM naming → Full CSS isolation, no theme conflicts
```

## Next Steps

- [ ] Build Gutenberg block editor UI (InspectorControls with style customization)
- [ ] Create Elementor widgets using same CSS
- [ ] Visual regression testing with Playwright screenshots
- [ ] Add more style customization attributes to shortcodes
