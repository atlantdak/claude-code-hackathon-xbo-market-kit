{
  "hooks": [
    {
      "type": "PreToolUse",
      "matcher": "Write|Edit",
      "hooks": [
        {
          "type": "command",
          "command": "bash -c 'FILE=\"$TOOL_INPUT_FILE_PATH\"; if [[ \"$FILE\" == *xbo-market-kit*.php ]]; then php -l \"$FILE\" 2>&1 || echo \"BLOCK: PHP syntax error in $FILE\"; fi'",
          "timeout": 10
        }
      ]
    },
    {
      "type": "PostToolUse",
      "matcher": "Write|Edit",
      "hooks": [
        {
          "type": "command",
          "command": "bash -c 'FILE=\"$TOOL_INPUT_FILE_PATH\"; PLUGIN_DIR=\"wp-content/plugins/xbo-market-kit\"; if [[ \"$FILE\" == *xbo-market-kit*.php ]] && command -v \"$PLUGIN_DIR/vendor/bin/phpcbf\" &>/dev/null; then cd \"$(dirname \"$FILE\")\" && \"$PLUGIN_DIR/vendor/bin/phpcbf\" --standard=\"$PLUGIN_DIR/phpcs.xml\" \"$FILE\" 2>/dev/null; fi'",
          "timeout": 30
        }
      ]
    },
    {
      "type": "Stop",
      "matcher": "",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "Before ending the session, automatically update all project metrics and documentation:\n\n1. Run `bash \".claude/plugins/xbo-ai-flow/scripts/collect-metrics.sh\" --json` to get fresh token/cost data\n2. Update `docs/metrics/tasks.json` totals (total_tokens, total_commits, total_cost_usd) with fresh data\n3. Update `docs/worklog/YYYY-MM-DD.md` Metrics table with current numbers\n4. Update `README.md` dashboard: KPI cards, Cost Breakdown pie chart, Token Usage pie chart, Commits per Task bar chart\n5. Commit changes: `git add docs/ README.md && git commit -m 'docs: auto-update metrics on session end'`\n\nDo this silently and efficiently. Do NOT push to remote."
        }
      ]
    }
  ]
}
