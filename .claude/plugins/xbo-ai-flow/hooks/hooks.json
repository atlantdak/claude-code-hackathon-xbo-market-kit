{
  "hooks": [
    {
      "type": "PreToolUse",
      "matcher": "Write|Edit",
      "hooks": [
        {
          "type": "command",
          "command": "bash -c 'FILE=\"$TOOL_INPUT_FILE_PATH\"; if [[ \"$FILE\" == *xbo-market-kit*.php ]]; then php -l \"$FILE\" 2>&1 || echo \"BLOCK: PHP syntax error in $FILE\"; fi'",
          "timeout": 10
        }
      ]
    },
    {
      "type": "PostToolUse",
      "matcher": "Write|Edit",
      "hooks": [
        {
          "type": "command",
          "command": "bash -c 'FILE=\"$TOOL_INPUT_FILE_PATH\"; PLUGIN_DIR=\"wp-content/plugins/xbo-market-kit\"; if [[ \"$FILE\" == *xbo-market-kit*.php ]] && command -v \"$PLUGIN_DIR/vendor/bin/phpcbf\" &>/dev/null; then cd \"$(dirname \"$FILE\")\" && \"$PLUGIN_DIR/vendor/bin/phpcbf\" --standard=\"$PLUGIN_DIR/phpcs.xml\" \"$FILE\" 2>/dev/null; fi'",
          "timeout": 30
        }
      ]
    },
    {
      "type": "Stop",
      "matcher": "",
      "hooks": [
        {
          "type": "command",
          "command": "bash \".claude/plugins/xbo-ai-flow/scripts/update-metrics-totals.sh\"",
          "timeout": 60
        },
        {
          "type": "prompt",
          "prompt": "MANDATORY: Before ending, update README.md dashboard with fresh data from docs/metrics/tasks.json.\n\n1. Read docs/metrics/tasks.json (it was just updated by the metrics script)\n2. Run `bash \".claude/plugins/xbo-ai-flow/scripts/collect-metrics.sh\" --json` for token details\n3. Update README.md: KPI cards (cost, time, tasks, commits, tokens, API calls), all Mermaid charts\n4. Commit: `git add docs/ README.md && git commit -m 'docs: auto-update metrics on session end'`\n\nDo NOT push. Do NOT skip this step."
        }
      ]
    }
  ]
}
